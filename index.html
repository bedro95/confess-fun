<!DOCTYPE html>
<html lang="ar" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confess.sol - Wallet Loss Analysis</title>
  <style>
    /* Reset */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #000000; /* أسود كامل */
      color: #FFD700; /* أصفر ذهبي */
      direction: rtl;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container {
      background: #121212; /* خلفية داكنة لكن أقل حدة من الأسود */
      padding: 40px 35px;
      border-radius: 18px;
      box-shadow:
        0 10px 30px rgba(255, 215, 0, 0.25),
        inset 0 0 40px rgba(255, 215, 0, 0.15);
      max-width: 430px;
      width: 90%;
      user-select: none;
    }
    h1 {
      margin-bottom: 40px;
      font-weight: 800;
      font-size: 2.6rem;
      letter-spacing: 3px;
      color: #FFD700;
      text-transform: uppercase;
      text-shadow:
        0 0 8px #FFD700,
        0 0 15px #FFD700;
    }
    input[type="text"] {
      width: 100%;
      padding: 16px 20px;
      border: none;
      border-radius: 12px;
      background-color: #222;
      color: #FFD700;
      font-size: 18px;
      letter-spacing: 1.2px;
      font-weight: 600;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      outline: none;
      box-shadow:
        inset 0 0 10px #FFD700;
    }
    input[type="text"]::placeholder {
      color: #BFAF2E;
      font-style: italic;
      opacity: 0.8;
    }
    input[type="text"]:focus {
      background-color: #333;
      box-shadow:
        0 0 12px #FFD700,
        inset 0 0 14px #FFD700;
      color: #FFF;
    }
    button {
      margin-top: 25px;
      width: 100%;
      padding: 16px 0;
      background: linear-gradient(90deg, #FFD700 0%, #FFC107 100%);
      border: none;
      border-radius: 14px;
      font-size: 20px;
      font-weight: 900;
      color: #000;
      cursor: pointer;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      box-shadow:
        0 6px 12px rgba(255, 215, 0, 0.6);
      transition: background 0.35s ease, box-shadow 0.35s ease;
      user-select: none;
    }
    button:hover {
      background: linear-gradient(90deg, #FFC107 0%, #FFEB3B 100%);
      box-shadow:
        0 10px 25px rgba(255, 215, 0, 0.9);
    }
    #result {
      margin-top: 35px;
      font-weight: 700;
      font-size: 1.25rem;
      min-height: 45px;
      color: #FFD700;
      letter-spacing: 0.9px;
      user-select: text;
      word-wrap: break-word;
      white-space: pre-wrap;
      text-shadow: 0 0 5px #FFD700;
    }

    footer {
      margin-top: 30px;
      color: #BFAF2E;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 1px;
      user-select: none;
      text-align: center;
      text-shadow: 0 0 3px #BFAF2E;
    }

    footer span {
      display: block;
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Confess.sol</h1>
    <input
      type="text"
      id="walletAddress"
      placeholder="Enter your wallet address"
      autocomplete="off"
      spellcheck="false"
    />
    <button onclick="analyzeWallet()">confess</button>
    <div id="result"></div>
  </div>

  <footer>
    <span>Version 2025</span>
    <span>Powered by Solana</span>
  </footer>

  <script>
    async function analyzeWallet() {
      const wallet = document.getElementById('walletAddress').value.trim();
      const resultDiv = document.getElementById('result');

      if (!wallet) {
        resultDiv.textContent = 'Please enter a wallet address.';
        return;
      }

      resultDiv.textContent = 'Analyzing... Please wait.';

      try {
        // جلب التوكنات من orb.fi API
        const tokensResponse = await fetch(`https://api.orb.fi/v0/tokens?wallet=${wallet}&chain=solana`);
        if (!tokensResponse.ok) {
          console.error('Failed to fetch tokens from Orb:', tokensResponse.status, tokensResponse.statusText);
          throw new Error('Failed to fetch tokens from Orb');
        }
        const tokensData = await tokensResponse.json();

        if (!tokensData || !tokensData.tokens || tokensData.tokens.length === 0) {
          resultDiv.textContent = 'No tokens found in the wallet.';
          return;
        }

        let largestLoss = 0;
        let largestLossToken = null;

        for (const token of tokensData.tokens) {
          const symbol = token.symbol || token.tokenSymbol || 'Unknown';
          const tokenAddress = token.address || token.tokenAddress;
          if (!tokenAddress) continue;

          const dexScreenerApi = `https://api.dexscreener.io/latest/dex/tokens/${tokenAddress}`;

          try {
            const priceResponse = await fetch(dexScreenerApi);
            if (!priceResponse.ok) {
              console.error(`Failed fetching price for ${symbol}:`, priceResponse.status);
              continue;
            }
            const priceData = await priceResponse.json();

            if (!priceData.pairs || priceData.pairs.length === 0) {
              console.warn(`No price pairs for ${symbol}`);
              continue;
            }

            const stats = priceData.pairs[0].stats;
            if (!stats) {
              console.warn(`No stats data for ${symbol}`);
              continue;
            }

            const high = parseFloat(stats.high ?? 0);
            const low = parseFloat(stats.low ?? 0);

            if (high && low) {
              const loss = high - low;
              if (loss > largestLoss) {
                largestLoss = loss;
                largestLossToken = symbol;
              }
            }
          } catch (e) {
            console.error(`Error fetching price data for ${symbol}:`, e);
            continue;
          }
        }

        if (largestLossToken) {
          resultDiv.textContent = `The largest loss was in ${largestLossToken} with an approximate value of $${largestLoss.toFixed(4)}`;
        } else {
          resultDiv.textContent = 'Could not calculate largest loss due to insufficient data.';
        }
      } catch (error) {
        console.error('Error during wallet analysis:', error);
        resultDiv.textContent = 'An error occurred during analysis. Please check the wallet address and try again.';
      }
    }
  </script>
</body>
</html>
